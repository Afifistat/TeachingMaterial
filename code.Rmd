# Inspection, visualisation and analysis of quantitative proteomics data

```{r style, echo = FALSE, results = 'asis', message=FALSE}
BiocStyle::markdown()
```

## Introduction

This document provides the details to reproduce the data analysis
figures in the course
[slides](http://lgatto.github.io/Quantitative-Proteomics-and-Data-Analysis/slides.html).

To be able to execute the code below, you will need to have a working
R installation. I also recommend using the
[RStudio editor](https://www.rstudio.com/products/RStudio/). To
install the proteomics add-on packages required for this tutorial, you
will need to run the following code:

```{r install, eval=FALSE}
## try http:// if https:// URLs are not supported
source("https://bioconductor.org/biocLite.R")
biocLite("RforProteomics", dependencies = TRUE)
biocLite("AnnotationHub")
```

For a more thorough introduction to R for proteomics, please read the
`RforProteomics` vignette
([online](http://bioconductor.org/packages/release/data/experiment/vignettes/RforProteomics/inst/doc/RforProteomics.pdf)
or off-line with `vignette("RforProteomics")` after installing as
described above). 

We first need to load the proteomics packages:

```{r env, message=FALSE}
library("MSnbase")
library("mzR")
library("RforProteomics")
library("pRoloc")
library("pRolocdata")
library("msmsTests")
library("AnnotationHub")
```

## Getting example data

`r Biocpkg("AnnotationHub")` is a cloud resource set up and managed by
the Bioconductor project that programmatically disseminates omics
data. I am working on contributing
[proteomics data](http://bioconductor.org/packages/devel/bioc/vignettes/ProteomicsAnnotationHubData/inst/doc/ProteomicsAnnotationHubData.html).

```{r ah}
ah <- AnnotationHub()
ms <- ah[["AH49008"]]
ms
```

> A simple series of BPI chromatograms, usually shown as a bitmap -
> why not plot them from exported data?

```{r xic}
x <- xic(ms, mz = 636.925, width = 0.01)
head(x)
```

> A series of panels that show the MS spectrum of a a SILAC
> heavy/light pair, in a nice diagram

(iTRAQ, don't have a SILAC data at hand for now)

```{r itraqdata}
data(itraqdata)
plot(itraqdata[[10]], reporters = iTRAQ4, full=TRUE)
```

> A set of protein LFQ data let’s say - two conditions, with 6
> replicates of each, and with a list of protein accession number and
> the LFQ data: This is a fabulous dataset for 

> S curves for means of both, with errors Matrix plot of all against
> all

log(Abundance) vs. protein index.

```{r msnset}
data(msnset)
pairs(exprs(msnset))
```

> Normalisation strategies

```{r normbxplot}
data(dunkley2006)
boxplot(exprs(dunkley2006))
boxplot(exprs(normalise(dunkley2006, method = "vsn")),
        main = "Variance stabilisation normalisation")
boxplot(exprs(normalise(dunkley2006, method = "center.median")),
        main = "Median")
boxplot(exprs(normalise(dunkley2006, method = "quantiles")),
        main = "Quantile")
```

> Heatmap plot

```{r heatmap}
data(msnset)
heatmap(exprs(msnset))
image(msnset)
```

> Hierarchical clustering (with or without heatmap)

```{r hclust}
data(dunkley2006)
heatmap(exprs(msnset))
hc <- hclust(dist(exprs(dunkley2006)))
plot(hc)
```

> Volcano plots

```{r volc}
data(msms.dataset)
e <- pp.msms.data(msms.dataset)
null.f <- "y~batch"
alt.f <- "y~treat+batch"
div <- apply(exprs(e), 2, sum)
res <- msms.glm.qlll(e, alt.f, null.f,div = div)
lst <- test.results(res, e, pData(e)$treat, "U600", "U200", div,
                    alpha = 0.05, minSpC = 2, minLFC = log2(1.8),
                    method = "BH")
res.volcanoplot(lst$tres, max.pval = 0.05,
                min.LFC = 1, maxx = 3, maxy = NULL,
                ylbls = 4)
```


> PCA analysis and plots

```{r pca}
plot2D(dunkley2006)
addLegend(dunkley2006, where = "topleft")
```

> Abundance histograms

See normalisation above.

> From a simpler set (e.g. Dean’s kdeg/protein/abundance) data, plot a
> 2d plot with colour as a third scaling variable

```{r pcacex}
data(hyperLOPIT2015)
setStockcol(paste0(getStockcol(), 60))
plot2D(hyperLOPIT2015,
       fcol = "final.assignment",
       cex = exp(fData(hyperLOPIT2015)$svm.score) - 1)
```

